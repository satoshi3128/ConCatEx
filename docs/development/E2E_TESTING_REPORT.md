
# E2Eテスト自動化の導入とテストシナリオ

## 1. E2Eテスト自動化手法の提案

手動での動作確認は時間がかかり、ヒューマンエラーが発生する可能性もあります。E2Eテストを自動化することで、アプリケーションの品質を継続的に保証し、デグレ（機能低下）を早期に検出することが可能になります。

### 1.1. 推奨フレームワーク: Playwright

現在のプロジェクト（Next.js, TypeScript）の技術スタックを考慮すると、Microsoftが開発しているモダンなE2Eテストフレームワーク **Playwright** の導入を強く推奨します。

### 1.2. Playwrightの選定理由

- **TypeScriptとの高い親和性**: 完全なTypeScriptサポートにより、型安全で保守性の高いテストコードを記述できます。
- **簡単なセットアップ**: `npm init playwright@latest` コマンド一つで、必要な設定ファイルやサンプルコードが自動生成され、すぐにテストを開始できます。
- **Auto-Waiting機能**: Playwrightは、操作対象の要素が表示されるまで自動で待機する機能を標準で備えています。これにより、「要素が見つからない」といったE2Eテストで頻発する不安定さを大幅に軽減できます。
- **クロスブラウザ対応**: Chromium (Google Chrome, Microsoft Edge), Firefox, WebKit (Safari) の主要なブラウザエンジンすべてに対応しており、一度書いたテストを異なるブラウザで実行できます。
- **強力なデバッグツール**: テスト実行の様子をステップごとに追跡できる **Trace Viewer** が非常に強力で、テストが失敗した際の状況把握や原因特定を容易にします。
- **テストコード自動生成**: **Codegen** 機能を使えば、ブラウザ上で行った操作を自動でテストコードに記録でき、テスト作成の初速を上げることができます。

### 1.3. 導入手順の概要

1.  **インストール**: ターミナルで `npm init playwright@latest` を実行し、対話形式で設定を進めます。
2.  **設定ファイルの確認**: `playwright.config.ts` が生成され、テストの実行方法（対象ブラウザ、並列実行数など）を細かく設定できます。
3.  **テストの記述**: `tests/e2e/` のようなディレクトリを作成し、`*.spec.ts` という命名規則でテストファイルを記述します。
4.  **テストの実行**: `npx playwright test` コマンドでテストを実行します。
5.  **結果の確認**: `npx playwright show-report` コマンドで、詳細なHTMLレポートをブラウザで確認できます。

---

## 2. ナビゲーション機能のテストシナリオ

ご報告いただいた「リロード時のナビゲーション表示不具合」を自動で検出し、修正後の動作を保証するためのテストシナリオを以下に示します。

### テストの目的

- ページのリロードやユーザーの操作（クリック、スクロール）に対して、ナビゲーションバーが常に正しいアクティブ状態を維持することを確認する。
- 状態の不整合による表示のちらつきや、複数項目が選択されるといった不具合が発生しないことを保証する。

### シナリオ1: クリックによるナビゲーション（正常系）

- **目的**: ナビゲーション項目をクリックした際に、正しく対象セクションへスクロールし、クリックした項目のみがアクティブになることを確認する。
- **テスト手順**:
    1.  トップページ (`/`) にアクセスする。
    2.  ナビゲーションの「経歴」ボタンをクリックする。
    3.  URLが `/#career` に変わる（または、`#career` の要素が画面内に表示される）ことを確認する。
    4.  ナビゲーションの「経歴」ボタンがアクティブ状態のスタイルになっていることを確認する。
    5.  他のナビゲーション項目（「自己紹介」など）が非アクティブ状態であることを確認する。
    6.  「スキル」「お問い合わせ」についても同様のテストを繰り返す。

### シナリオ2: スクロールによるナビゲーション状態の追従（正常系）

- **目的**: ページをスクロールした際に、現在表示されているセクションに応じてナビゲーションのアクティブ状態が動的に切り替わることを確認する。
- **テスト手順**:
    1.  トップページ (`/`) にアクセスする。
    2.  ページを一番下までスクロールする。
    3.  `#contact`（お問い合わせ）セクションが画面内に表示されていることを確認する。
    4.  ナビゲーションの「お問い合わせ」ボタンがアクティブ状態になっていることを確認する。
    5.  ページを上方向に「スキル」セクションまでスクロールする。
    6.  `#skills`（スキル）セクションが画面内に表示されていることを確認する。
    7.  ナビゲーションの「スキル」ボタンがアクティブ状態になっていることを確認する。

### シナリオ3: リロード時のアクティブ状態復元（不具合検証）

- **目的**: 特定のセクションが表示された状態でページをリロードした際に、ナビゲーションが正しいアクティブ状態を復元することを確認する。
- **テスト手順**:
    1.  「お問い合わせ」セクションのURL (`/#contact`) に直接アクセスする。
    2.  ページが完全に読み込まれるのを待つ。
    3.  `#contact`（お問い合わせ）セクションが画面内に表示されていることを確認する。
    4.  **[重要]** ナビゲーションの「お問い合わせ」ボタンがアクティブ状態になっていることを確認する。
    5.  **[重要]** 「自己紹介」ボタンが非アクティブ状態であることを確認する。

### シナリオ4: リロード後の操作における状態の安定性（不具合検証）

- **目的**: リロードによって内部状態が不安定になった後でも、ユーザーの操作によって状態が正常に更新され、二重選択などの不具合が起きないことを確認する。
- **テスト手順**:
    1.  「お問い合わせ」セクションのURL (`/#contact`) に直接アクセスする。
    2.  ページが完全に読み込まれるのを待つ。
    3.  ナビゲーションの「スキル」ボタンをクリックする。
    4.  `#skills`（スキル）セクションにスクロールしたことを確認する。
    5.  **[重要]** ナビゲーションの「スキル」ボタン**のみ**がアクティブ状態になっていることを確認する。
    6.  **[重要]** 他のすべてのナビゲーション項目が非アクティブ状態であることを確認する。

---

## 3. まとめ

Playwrightを導入し、上記シナリオを自動化することで、開発者はコード修正のたびに手動で動作確認を行う必要がなくなります。CI/CDパイプラインにこのE2Eテストを組み込むことで、品質の高いアプリケーションを安定して提供し続ける体制を構築できます。
