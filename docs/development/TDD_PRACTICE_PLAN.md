# TDD（テスト駆動開発）実践計画書

## 1. TDDとは

テスト駆動開発（TDD）は、ソフトウェア開発手法の一つであり、「テストを先に書く」ことを特徴とします。単にテストを書くだけでなく、**テストが開発プロセスそのものを駆動（ドライブ）する**という考え方に基づいています。

### TDDのサイクル：レッド・グリーン・リファクター

TDDは、以下の3つのステップを短時間で繰り返すことで進行します。

1.  **RED**: **失敗するテストを書く**
    - これから実装する機能や修正するバグに対する、小さなテストケースを作成します。この時点では実装が存在しないため、テストは必ず失敗します（RED）。

2.  **GREEN**: **テストをパスさせる**
    - REDのテストを成功させるための、**最小限のコード**を実装します。この段階では、コードの綺麗さよりも、まずテストをパスさせること（GREEN）を優先します。

3.  **REFACTOR**: **コードをクリーンにする**
    - テストがパスしている状態を維持したまま、実装したコードの品質を向上させます。重複の排除、命名の改善、設計の最適化などを行い、誰が見ても分かりやすく、メンテナンス性の高いコードを目指します。

## 2. このプロジェクトにおけるTDDの実践

このプロジェクトでは、`Vitest` と `React Testing Library` が導入されており、TDDを実践するための環境は整っています。

### ケーススタディ1：新機能「ダークモード切替」の実装

1.  **RED**: テストファイル `__tests__/components/ThemeToggle.test.tsx` を作成します。
    - 「テーマ切替スイッチがレンダリングされること」を期待するテストを書きます。コンポーネントが存在しないため、テストは失敗します。
    - 次に、「スイッチをクリックすると、`<html>` タグに `dark` クラスが付与されること」を期待するテストを追加します。これも失敗します。

2.  **GREEN**: `components/ThemeToggle.tsx` を作成します。
    - まず、ボタン要素を返すだけのシンプルなコンポーネントを実装し、最初のテストをパスさせます。
    - 次に、`useState` と `useEffect` を使って、クリック時に `<html>` タグにクラスを付与するロジックを実装し、2つ目のテストをパスさせます。

3.  **REFACTOR**: 実装したコードを見直します。
    - 状態管理ロジックが複雑な場合は、カスタムフック（`useTheme`など）に切り出すことを検討します。
    - 変数名やコンポーネントの構造が適切かを確認し、可読性を高めます。

### ケーススタディ2：バグ修正「お問い合わせフォームのバリデーション」

現在、`ContactForm` のテストは失敗しています。これをTDDのサイクルで修正します。

1.  **RED**: `__tests__/components/ContactForm.test.tsx` の失敗しているテストケース（例：「必須項目が空の場合にバリデーションエラーが表示される」）が、まさにREDの状態です。これにより、バグがテストで再現されていることが確認できます。

2.  **GREEN**: `components/ContactForm.tsx` のロジックを修正し、このテストをパスさせます。例えば、`handleSubmit` 内のバリデーションロジックが正しくエラーメッセージをstateにセットするように修正します。

3.  **REFACTOR**: バリデーションロジックが複雑であれば、`utils/validator.ts` のような別ファイルに切り出し、フォームコンポーネントの見通しを良くします。また、関連する他のテストが失敗していないかも確認します。

## 3. TDDのメリット

- **品質の向上**: 全てのコードがテストによって保証されるため、バグが減り、リグレッション（意図しない副作用）を防ぎやすくなります。
- **優れた設計**: テストしやすいコードを書くことは、自然とコンポーネントの関心を分離し、再利用性の高い設計につながります。
- **ドキュメントとしての役割**: テストコードは、そのコンポーネントが「どのように動作することを期待されているか」を示す生きたドキュメントになります。
- **自信のあるリファクタリング**: テストが安全網となるため、開発者は安心してコードの改善に取り組むことができます。
